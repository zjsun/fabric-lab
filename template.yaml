version: '2'

networks:
  samples:

services:
  ca.bank1.samples.cn:
    extends:
      file: base.yaml
      service: fabric_ca
    container_name: ca.bank1.samples.cn
    environment:
      - FABRIC_CA_SERVER_CA_NAME=ca-bank1
      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.bank1.samples.cn-cert.pem
      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA_BANK1_PRIVATE_KEY
    command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.bank1.samples.cn-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA_BANK1_PRIVATE_KEY -b admin:adminpw -d'
    volumes:
      - ./crypto-config/peerOrganizations/ca.bank1.samples.cn/ca/:/etc/hyperledger/fabric-ca-server-config
    ports:
      - "7054:7054"

  ca.owner1.samples.cn:
    extends:
      file: base.yaml
      service: fabric_ca
    container_name: ca.owner1.samples.cn
    environment:
      - FABRIC_CA_SERVER_CA_NAME=ca-owner1
      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.owner1.samples.cn-cert.pem
      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA_OWNER1_PRIVATE_KEY
    command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.owner1.samples.cn-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA_OWNER1_PRIVATE_KEY -b admin:adminpw -d'
    volumes:
      - ./crypto-config/peerOrganizations/ca.owner1.samples.cn/ca/:/etc/hyperledger/fabric-ca-server-config
    ports:
      - "8054:7054"

  ca.storage1.samples.cn:
    extends:
      file: base.yaml
      service: fabric_ca
    container_name: ca.storage1.samples.cn
    environment:
      - FABRIC_CA_SERVER_CA_NAME=ca-storage1
      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.storage1.samples.cn-cert.pem
      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA_STORAGE1_PRIVATE_KEY
    command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.storage1.samples.cn-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA_STORAGE1_PRIVATE_KEY -b admin:adminpw -d'
    volumes:
      - ./crypto-config/peerOrganizations/ca.storage1.samples.cn/ca/:/etc/hyperledger/fabric-ca-server-config
    ports:
      - "9054:7054"

  ca.supervisor1.samples.cn:
    extends:
      file: base.yaml
      service: fabric_ca
    container_name: ca.supervisor1.samples.cn
    environment:
      - FABRIC_CA_SERVER_CA_NAME=ca-supervisor1
      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.supervisor1.samples.cn-cert.pem
      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA_SUPERVISOR1_PRIVATE_KEY
    command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.supervisor1.samples.cn-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA_SUPERVISOR1_PRIVATE_KEY -b admin:adminpw -d'
    volumes:
      - ./crypto-config/peerOrganizations/ca.supervisor1.samples.cn/ca/:/etc/hyperledger/fabric-ca-server-config
    ports:
      - "10054:7054"

  orderer1.samples.cn:
    extends:
      file:   base.yaml
      service: fabric_orderer
    container_name: orderer1.samples.cn
    volumes:
      - ./crypto-config/ordererOrganizations/samples.cn/orderers/orderer1.samples.cn/msp:/var/hyperledger/orderer/msp
      - ./crypto-config/ordererOrganizations/samples.cn/orderers/orderer1.samples.cn/tls/:/var/hyperledger/orderer/tls
    ports:
      - "7050:7050"

  peer0.bank1.samples.cn:
    container_name: peer0.bank1.samples.cn
    extends:
      file:  base.yaml
      service: fabric_peer
    environment:
      - CORE_PEER_ID=peer0.bank1.samples.cn
      - CORE_PEER_ADDRESS=peer0.bank1.samples.cn:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.bank1.samples.cn:7051
      - CORE_PEER_LOCALMSPID=Bank1MSP
    volumes:
      - ./crypto-config/peerOrganizations/bank1.samples.cn/peers/peer0.bank1.samples.cn/msp:/etc/hyperledger/fabric/msp
      - ./crypto-config/peerOrganizations/bank1.samples.cn/peers/peer0.bank1.samples.cn/tls:/etc/hyperledger/fabric/tls
    ports:
      - "7051:7051"
      - "7053:7053"

  peer0.owner1.samples.cn:
    container_name: peer0.owner1.samples.cn
    extends:
      file:  base.yaml
      service: fabric_peer
    environment:
      - CORE_PEER_ID=peer0.owner1.samples.cn
      - CORE_PEER_ADDRESS=peer0.owner1.samples.cn:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.owner1.samples.cn:7051
      - CORE_PEER_LOCALMSPID=Owner1MSP
    volumes:
      - ./crypto-config/peerOrganizations/owner1.samples.cn/peers/peer0.owner1.samples.cn/msp:/etc/hyperledger/fabric/msp
      - ./crypto-config/peerOrganizations/owner1.samples.cn/peers/peer0.owner1.samples.cn/tls:/etc/hyperledger/fabric/tls
    ports:
      - "8051:7051"
      - "8053:7053"

  peer0.storage1.samples.cn:
    container_name: peer0.storage1.samples.cn
    extends:
      file:  base.yaml
      service: fabric_peer
    environment:
      - CORE_PEER_ID=peer0.storage1.samples.cn
      - CORE_PEER_ADDRESS=peer0.storage1.samples.cn:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.storage1.samples.cn:7051
      - CORE_PEER_LOCALMSPID=Storage1MSP
    volumes:
      - ./crypto-config/peerOrganizations/storage1.samples.cn/peers/peer0.storage1.samples.cn/msp:/etc/hyperledger/fabric/msp
      - ./crypto-config/peerOrganizations/storage1.samples.cn/peers/peer0.storage1.samples.cn/tls:/etc/hyperledger/fabric/tls
    ports:
      - "9051:7051"
      - "9053:7053"

  peer0.supervisor1.samples.cn:
    container_name: peer0.supervisor1.samples.cn
    extends:
      file:  base.yaml
      service: fabric_peer
    environment:
      - CORE_PEER_ID=peer0.supervisor1.samples.cn
      - CORE_PEER_ADDRESS=peer0.supervisor1.samples.cn:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.supervisor1.samples.cn:7051
      - CORE_PEER_LOCALMSPID=Supervisor1MSP
    volumes:
      - ./crypto-config/peerOrganizations/supervisor1.samples.cn/peers/peer0.supervisor1.samples.cn/msp:/etc/hyperledger/fabric/msp
      - ./crypto-config/peerOrganizations/supervisor1.samples.cn/peers/peer0.supervisor1.samples.cn/tls:/etc/hyperledger/fabric/tls
    ports:
      - "10051:7051"
      - "10053:7053"